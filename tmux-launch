#/bin/bash

# help:
#
# background: run in background (good for headless server)

AVAILABLE_WINDOW=0
run-in-tmux() {
    list_of_commands=("$@")
    #echo "run in tmux: ${SESSION}: $@"
    tmux new-window -t ${SESSION}:${AVAILABLE_WINDOW}
    tmux send-keys -t ${SESSION}:${AVAILABLE_WINDOW} "PATH=$PATH" C-m
    tmux send-keys -t ${SESSION}:${AVAILABLE_WINDOW} "NODE_PATH=$NODE_PATH" C-m
    tmux send-keys -t ${SESSION}:${AVAILABLE_WINDOW} "clear" C-m
    for i in "${list_of_commands[@]}"; do
        tmux send-keys -t ${SESSION}:${AVAILABLE_WINDOW} "$i" C-m
    done
    AVAILABLE_WINDOW=$((${AVAILABLE_WINDOW}+1))
}

SESSION_BASE="$(basename "$0")"

start-tmux-session() {
    SESSION_NUMBER=$1
    SESSION="${SESSION_BASE}-$1"
    #echo "Session name is: $SESSION"
    tmux start-server
    tmux new-session -d -s ${SESSION}
}

attach-tmux-session() {
    SESSION_NUMBER=$1
    SESSION="${SESSION_BASE}-$1"
    #echo "Session name is: $SESSION"
    tmux attach -t $SESSION
}
